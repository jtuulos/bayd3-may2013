<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>D3.js + Backbone.js = Reusable Charts</title>

    <meta name="description" content="Building reusable charts with D3.js and Backbone.js">
    <meta name="author" content="Jyri Tuulos">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/sky.css" id="theme">
    <link rel="stylesheet" href="css/slides.css">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/idea.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
        document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <script src="//cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
</head>

<body>

<div class="reveal"><div class="slides">

    <section>
        <h2>D3 + Backbone<br>=<br>Reusable Charts</h2><br>
        <p><a href="http://twitter.com/jtuulos" target="_blank">@jtuulos</a></p>
        <p class="small">May 9, 2013</p>
    </section>

    <section>
        <h2>Why reusable charts?</h2>
        <p><i class="icon-eye-close"></i> Abstraction</p>
        <p><i class="icon-link"></i> Modularity</p>
        <p><i class="icon-wrench"></i> Maintenance</p>
        <p><i class="icon-github"></i> Collaboration</p>

        <aside class="notes">
            <ul>
                <li>abstract away the D3</li>
                <li>D3 is hard for JavaScript beginners</li>
                <li>code structure is a must in large apps</li>
                <li>separating logic from data schema</li>
                <li>open sourcing parts of apps (e.g. Bootstrap)</li>
            </ul>
        </aside>
    </section>

    <section>
        <h2>Web frameworks &amp; D3</h2>
        <div class="col2 fragment" data-fragment-index="0">
            <h4><span class="legend-server">Server-side</span> framework + <span class="legend-client">D3</span></h4>
            <div class="mock-div">
                <div class="mock-div">Header</div>
                <div class="mock-div">
                    <p>List</p>
                    <div class="mock-div">
                        <p>Item</p>
                        <div class="mock-div svg">
                            <div class="mock-div client-side fragment" data-fragment-index="1">
                                <strong><i class="icon-bar-chart"></i> D3 chart</strong>
                            </div>
                        </div>
                    </div>
                    <div class="mock-div">
                        <p>Item</p>
                        <div class="mock-div svg">
                            <div class="mock-div client-side fragment" data-fragment-index="1">
                                <strong><i class="icon-bar-chart"></i> D3 chart</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col2 fragment" data-fragment-index="2">
            <h4><span class="legend-client">Client-side</span> framework + <span class="legend-client">D3</span></h4>
            <div class="mock-div">
                <div class="mock-div">Header</div>
                <div class="mock-div client-side fragment" data-fragment-index="3">
                    <p>ListView</p>
                    <div class="mock-div client-side fragment" data-fragment-index="4">
                        <p>ItemView</p>
                        <div class="mock-div client-side fragment" data-fragment-index="5">
                            <strong><i class="icon-bar-chart"></i> D3 chart</strong>
                        </div>
                    </div>
                    <div class="mock-div client-side fragment" data-fragment-index="4">
                        <p>ItemView</p>
                        <div class="mock-div client-side fragment" data-fragment-index="5">
                            <strong><i class="icon-bar-chart"></i> D3 chart</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <aside class="notes">
            <ul>
                <li>client-side: svg elements don't exist initially</li>
                <li>there's already a hierarchy of views, why not have D3 views?</li>
                <li>rendering optimizations, real-time charts</li>
            </ul>
        </aside>
    </section>

    <section>
        <h2><img src="img/backbone.png" alt="Backbone.js" class="logo" width="450"></h2>
        <p>Helpful methods to <strong>manipulate and query your data</strong></p>
        <p>"Backbone is a library, not a framework"</p>
        <p><strong>Plays well with others</strong></p>
        <p class="small">(from the <a href="http://backbonejs.org/#FAQ-why-backbone" target="_blank">official FAQ</a>)</p>

        <aside class="notes">
            <ul>
                <li>Who here has used Backbone?</li>
                <li>does not impose HTML markup, template engine or UI widgets</li>
                <li>frameworks built on top of Backbone: <a href="http://marionettejs.com/">Marionette</a>, <a href="http://chaplinjs.org/">Chaplin</a></li>
                <li>build your own framework -> YMMV</li>
            </ul>
        </aside>
    </section>

    <section>
        <section>
            <h3>Goal: Spreadsheet charts</h3>
            <img src="img/spreadsheet_chart.png">
        </section>
        <section>
            <h3>Goal: JSON + <span class="legend-backbone">Backbone</span> + <span class="legend-d3">D3</span></h3>
            <div class="col2">
                <pre><code data-trim>
var json = [
  {"letter": "A", "frequency": 0.08167},
  {"letter": "B", "frequency": 0.01492},
  {"letter": "C", "frequency": 0.02780},
  {"letter": "D", "frequency": 0.04253},
  {"letter": "E", "frequency": 0.12702},
  {"letter": "F", "frequency": 0.02288},
  {"letter": "G", "frequency": 0.02022},
  {"letter": "H", "frequency": 0.06094},
  {"letter": "I", "frequency": 0.06973},
  {"letter": "J", "frequency": 0.00153},
  {"letter": "K", "frequency": 0.00747},
  {"letter": "L", "frequency": 0.04025},
  ...
];
                </code></pre>
            </div>
            <div class="col2">
                <pre class="backbone"><code data-trim>
// Custom view (inherits Backbone.View)
var chart = new BarChart({

  // Basic Backbone view options
  el: $("#chart-container"),
  collection: new Backbone.Collection(json),

  // Custom chart options
  xAttr: "letter",
  yAttr: "frequency"

});

// D3 code abstracted away
chart.render();
                </code></pre>
            </div>
        </section>
    </section>

    <section>
        <h3>Example: <span class="legend-d3">D3</span> bar chart</h3>
        <iframe src="http://bl.ocks.org/mbostock/raw/3885304/adf6163abdd2bb12a5e776594a01ea668f757cdd/" marginwidth="0" marginheight="0" scrolling="no" width="960" height="500"></iframe>
        <p class="small"><a href="http://bl.ocks.org/mbostock/3885304" target="_blank">by <strong>Mike Bostock</strong></a></p>
    </section>

    <section>
        <div class="col2">
            <pre class="d3"><code class="full-height" data-trim>
// http://bl.ocks.org/mbostock/3885304

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var formatPercent = d3.format(".0%");

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(formatPercent);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.tsv("data.tsv", function(error, data) {

  data.forEach(function(d) {
    d.frequency = +d.frequency;
  });

  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Frequency");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.letter); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.frequency); })
      .attr("height", function(d) { return height - y(d.frequency); });

});
            </code></pre>
        </div>
        <div class="col2 fragment" data-fragment-index="1">
            <pre class="minimap d3">
<span class="section margins">var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
<span class="label">Margins</span>
</span><span class="section scales">var formatPercent = d3.format(".0%");

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);
<span class="label">Scales</span>
</span><span class="section axes">var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(formatPercent);
<span class="label">Axes</span>
</span><span class="section margins">var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
<span class="label">Margins</span>
</span><span class="section data">d3.tsv("data.tsv", function(error, data) {

  data.forEach(function(d) {
    d.frequency = +d.frequency;
  });
<span class="label">Data</span>
</span><span class="section scales">  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);
<span class="label">Scales</span>
</span><span class="section axes">  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Frequency");
<span class="label">Axes</span>
</span><span class="section bars">  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.letter); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.frequency); })
      .attr("height", function(d) { return height - y(d.frequency); });
});
<span class="label">Bars</span>
</span>
            </pre>
        </div>

        <aside class="notes">
            <ul>
                <li>"canonical" code</li>
                <li>not bad code in itself, good as a simple example</li>
                <li>some parts could be reused for other charts</li>
            </ul>
        </aside>
    </section>

    <section>
        <h2><span class="legend-d3">D3</span> is declarative,<br><span class="legend-backbone">MV*</span> is object-oriented</h2>
        <p class="fragment">
            <strong><i class="icon-arrow-right"></i> Encapsulation</strong>
        </p>
        <p class="small fragment">
            (<a href="http://bost.ocks.org/mike/chart/" target="_blank">Towards Reusable Charts</a>)
        </p>

        <aside class="notes">
            <ul>
                <li>declarative = describe <strong>what</strong> to show, not <strong>how</strong></li>
                <li>not only Backbone, but also Ember, Angular etc.</li>
                <li>make D3 play nicely with the surrounding app</li>
                <li>encapsulation: "D3 style" or "Backbone style"?</li>
            </ul>
        </aside>
    </section>

    <section>
        <h2>Let's wrap D3 in Backbone</h2>
        <img src="img/bacon-asparagus.jpg">
    </section>

    <section>
        <h3>Dimensions and margin convention</h3>
        <div class="col2">
            <pre class="d3"><code data-trim>
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            </code></pre>
        </div>
        <div class="col2 fragment">
            <pre class="backbone"><code data-trim>
var ChartBase = Backbone.View.extend({

  // Default options
  defaults: {
    margin: {top: 20, right: 20, bottom: 30, left: 40}
  },

  render: function() {
    var margin = this.options.margin;
    this.width = this.$el.width() - margin.left - margin.right;
    this.height = this.$el.height() - margin.top - margin.bottom;

    this.svg = d3.select(this.el).append("svg")
        .attr("width", this.width + margin.left + margin.right)
        .attr("height", this.height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    return this;
  }

});
            </code></pre>
        </div>

        <aside class="notes">
            <ul>
                <li>container element and dimensions are now options</li>
                <li>configurable margins</li>
                <li>global variables as object properties</li>
                <li>the implementation still looks like familiar D3</li>
            </ul>
        </aside>
    </section>

    <section>
        <h3>Base chart interface</h3>
        <div class="col2">
            <pre class="backbone"><code data-trim>
var ChartBase = Backbone.View.extend({

  defaults: {
    xAttr: "x",
    yAttr: "y",
    margin: {...}
  },

  render: function() {
    ... // Append SVG element, set margins

    this.scales = {
        x: this.getXScale(),
        y: this.getYScale()
    };
    this.renderAxes();
    this.renderData();

    return this;
  }

});
            </code></pre>
        </div>
        <div class="col2 fragment">
            <p class="small">Usage:</p>
            <pre class="backbone language-javascript"><code data-trim>
// Create chart object (BarChart inherits ChartBase)
var chart = new BarChart({

  // Basic Backbone view options
  el: $("#chart-container"),
  collection: new Backbone.Collection(json),

  // Override default options to match data
  // (use default margins)
  xAttr: "letter",
  yAttr: "frequency"

});

// Sets margins, gets scales, renders data
chart.render();
            </code></pre>
        </div>

        <aside class="notes">
            <ul>
                <li></li>
            </ul>
        </aside>
    </section>

    <section>
        <h3>Bar chart: Scales</h3>
        <div class="col2">
            <pre class="d3"><code data-trim>
var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

...

x.domain(data.map(function(d) { return d.letter; }));
y.domain([0, d3.max(data, function(d) { return d.frequency; })]);
            </code></pre>
        </div>
        <div class="col2 fragment">
            <pre class="backbone"><code data-trim>
var BarChart = ChartBase.extend({

  defaults: _.defaults({
    barPadding: 0.1
  }, ChartBase.prototype.defaults),

  getXScale: function() {
    var padding = this.options.barPadding;
    return d3.scale.ordinal()
      .rangeRoundBands([0, this.width], padding)
      .domain(this.collection.pluck(this.options.xAttr));
  },

  getYScale: function() {
    return d3.scale.linear()
      .rangeRound([this.height, 0])
      .domain([0, d3.max(this.collection.pluck(this.options.yAttr))]);
  }

});
            </code></pre>
        </div>
    </section>

    <section>
        <h3>Bar chart: Axes</h3>
        <div class="col2">
            <pre class="d3"><code data-trim>
var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(d3.format(".0%"));

...

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);
            </code></pre>
        </div>
        <div class="col2 fragment">
            <pre class="backbone"><code data-trim>
var BarChart = ChartBase.extend({

  renderAxes: function() {
    var xAxis = d3.svg.axis()
      .scale(this.scales.x)
      .orient("bottom");

    var yAxis = d3.svg.axis()
      .scale(this.scales.y)
      .orient("left")
      .tickFormat(d3.format(".0%"));

    this.svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + this.height + ")")
      .call(xAxis);

    this.svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
  }

});
            </code></pre>
        </div>
    </section>

    <section>
        <h3>Bar chart: Rendering data</h3>
        <div class="col2">
            <pre class="d3"><code data-trim>
svg.selectAll(".bar")
    .data(data)
  .enter().append("rect")
    .attr("class", "bar")
    .attr("x", function(d) { return x(d.letter); })
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.frequency); })
    .attr("height", function(d) { return height - y(d.frequency); });
            </code></pre>
        </div>
        <div class="col2 fragment">
            <pre class="backbone"><code data-trim>
var BarChart = ChartBase.extend({

  renderData: function() {
    var chart = this,
        x = this.scales.x,
        y = this.scales.y;

    this.svg.selectAll(".bar")
        .data(this.mapData()) // { x: xAttr, y: yAttr }
      .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function(d) { return x(d.x); })
        .attr("width", x.rangeBand())
        .attr("y", function(d) { return y(d.y); })
        .attr("height", function(d) { return chart.height - y(d.y); });
  }

});
            </code></pre>
        </div>
    </section>

    <section>
        <h3>As basic as it gets</h3>
        <div class="col2">
            <pre class="backbone language-javascript"><code data-trim>
var chart = new BarChart({

  el: $("#chart-container"),
  collection: new Backbone.Collection(json),

  xAttr: "letter",
  yAttr: "frequency"

});

chart.render();
            </code></pre>
        </div>
        <div class="col2">
            <img src="img/chart-result.png">
        </div>
    </section>

    <section>
        <h2>But wait, there's more</h2>
        <p><a href="http://backbonejs.org/#Events-catalog" target="_blank">Re-rendering when data changes</a></p>
        <p><a href="http://backbonejs.org/#Sync" target="_blank">Using remote data <span class="small">(AJAX)</span></a></p>
        <p><a href="http://shirley.quora.com/Marrying-Backbone-js-and-D3-js" target="_blank">Interactivity <span class="small">(DOM events)</span></a></p>
        <p><a href="https://github.com/mbostock/d3/wiki/Gallery" target="_blank">More chart types</a></p>

        <aside class="notes">
            <ul>
                <li>interacting with REST APIs is the main strength of Backbone</li>
                <li>remove repetition, only the fun parts of D3 remain</li>
                <li>post by Shirley Wu</li>
            </ul>
        </aside>
    </section>

    <section>
        <h2>Getting started</h2>
        <p><a href="http://d3js.org" target="_blank">d3js.org</a></p>
        <p class="small"><a href="http://biovisualize.github.io/d3visualization/" target="_blank">biovisualize.github.io/d3visualization</a></p>
        <br>
        <p><a href="http://backbonejs.org" target="_blank">backbonejs.org</a></p>
        <p class="small"><a href="https://github.com/tbranyen/backbone-boilerplate" target="_blank">tbranyen/backbone-boilerplate</a></p>
    </section>

    <section>
        <h2>Stay tuned!</h2>
        <p>We&nbsp;&nbsp;<i class="icon-github-alt icon-large"></i>&nbsp;&nbsp;open source</p>
        <p><a href="https://bitdeli.com/free" target="_blank"><strong>bitdeli.com/free</strong></a></p>
        <p class="small">
            <a href="mailto:jyri@bitdeli.com" target="_blank">jyri@bitdeli.com</a> /
            <a href="http://twitter.com/jtuulos" target="_blank">@jtuulos</a>
        </p>
    </section>

</div></div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,
    rollingLinks: false,

    width: 1140,
    height: 620,

    theme: 'sky',
    transition: 'linear',

    dependencies: [
        { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
        { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
        { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
        { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
    ]
});

</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40746204-1', 'github.io');
  ga('send', 'pageview');
</script>

</body>
</html>
